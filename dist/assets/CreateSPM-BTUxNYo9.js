import{f as C,q as F,x as V,h as d,g as j,y as f,r as B,o as n,c as i,a,b as R,w as $,m as g,v as h,n as c,s as v,F as U,j as z,z as y,p as I,t as k}from"./index-DA5MY6av.js";import{T as L}from"./ToastAlert-fqu-tfal.js";const O={"aria-label":"breadcrumb"},q={class:"breadcrumb"},E={class:"breadcrumb-item"},K={class:"row"},A={class:"col-md-6 col-lg-4"},G={key:0,class:"invalid-feedback"},H={class:"col-md-6 col-lg-4"},J={key:0,class:"invalid-feedback"},Q={class:"col-md-6 col-lg-4"},W=["value"],X={key:0,class:"invalid-feedback"},Y={class:"col-12"},Z={class:"card"},ll={class:"card-body"},al={class:"table-sm table table-bordered"},el={key:0,class:"text-center"},tl=["onChange"],sl=["disabled"],rl={__name:"CreateSPM",setup(ol){const m=C(),T=F(),_=V(),M=d([]),t=d({noSPM:"",tglSPM:"",nilaiSPM:0}),o=d({noSPM:!1,tglSPM:!1,nilaiSPM:!1}),u=d([]);j(async()=>{M.value=await m.fetchData("delegasiPegawai")});const P=f(()=>M.value.filter(e=>typeof e=="object"&&e!==null&&"relation"in e&&e.relation&&e.relation.length>0)),b=e=>{var l;return(l=e.relation)==null?void 0:l.reduce((r,s)=>r+s.totalSemuaDana,0)},w=()=>{const e=u.value.reduce((l,r)=>l+b(r),0);t.value.nilaiSPM=e},x=e=>{const l=u.value.indexOf(e);l===-1?u.value.push(e):u.value.splice(l,1),w()},S=d(!1),p=f({get(){return t.value.noSPM!==""&&t.value.tglSPM!==""&&t.value.nilaiSPM>0},set(e){S.value=e}}),N=async()=>{if(!p.value)return;S.value=!0;const e={...y(t.value),selectedST:y(u.value)};await m.addItem("spm",e),S.value=!1,L.fire({icon:"success",title:"Data Berhasil ditambahkan"}),_.dataSPM=null,T.push("/spm")};return(e,l)=>{const r=B("router-link");return n(),i("div",null,[a("nav",O,[a("ol",q,[a("li",E,[R(r,{to:{name:"spm"}},{default:$(()=>l[5]||(l[5]=[I("SPM")])),_:1})]),l[6]||(l[6]=a("li",{class:"breadcrumb-item","aria-current":"page"},"Tambah Data",-1))])]),l[13]||(l[13]=a("h1",{class:"text-dark fw-bold mb-4"},"Tambah Data SPM",-1)),a("div",K,[a("div",A,[a("div",null,[l[7]||(l[7]=a("label",{for:"noSPM",class:"form-label"},"No SPM",-1)),g(a("input",{type:"text",class:c(["form-control",{"is-invalid":o.value.noSPM&&t.value.noSPM===""}]),"onUpdate:modelValue":l[0]||(l[0]=s=>t.value.noSPM=s),id:"noSPM",onFocus:l[1]||(l[1]=s=>o.value.noSPM=!0)},null,34),[[h,t.value.noSPM]]),o.value.noSPM&&t.value.noSPM===""?(n(),i("div",G," No SPM wajib diisi. ")):v("",!0)])]),a("div",H,[a("div",null,[l[8]||(l[8]=a("label",{for:"tglSPM",class:"form-label"},"Tanggal SPM",-1)),g(a("input",{type:"date",class:c(["form-control",{"is-invalid":o.value.tglSPM&&t.value.tglSPM===""}]),"onUpdate:modelValue":l[2]||(l[2]=s=>t.value.tglSPM=s),id:"tglSPM",onFocus:l[3]||(l[3]=s=>o.value.tglSPM=!0)},null,34),[[h,t.value.tglSPM]]),o.value.tglSPM&&t.value.tglSPM===""?(n(),i("div",J," Tanggal SPM wajib diisi. ")):v("",!0)])]),a("div",Q,[a("div",null,[l[9]||(l[9]=a("label",{for:"nilai",class:"form-label"},"Nilai SPM",-1)),a("input",{type:"text",class:c(["form-control",{"is-invalid":o.value.nilaiSPM&&t.value.nilaiSPM<=0}]),value:e.formatRupiah(t.value.nilaiSPM),readonly:"",id:"nilai",onFocus:l[4]||(l[4]=s=>o.value.nilaiSPM=!0)},null,42,W),o.value.nilaiSPM&&t.value.nilaiSPM<=0?(n(),i("div",X," Nilai SPM wajib diisi. ")):v("",!0),l[10]||(l[10]=a("span",{class:"fs-1 text-info"}," Untuk mengisi Nilai SPM, Silahkan pilih ST dari tabel di bawah ",-1))])]),a("div",Y,[a("div",Z,[l[12]||(l[12]=a("div",{class:"card-header"},"Pilih NO ST",-1)),a("div",ll,[a("table",al,[l[11]||(l[11]=a("thead",null,[a("tr",null,[a("th",null,"Pilih"),a("th",null,"No ST"),a("th",null,"Total Dana Seluruhnya")])],-1)),a("tbody",null,[P.value.length<0?(n(),i("div",el,"Data Masih Kosong")):v("",!0),(n(!0),i(U,null,z(P.value,(s,D)=>(n(),i("tr",{key:D},[a("td",null,[a("input",{class:"form-check-input",type:"checkbox",style:{width:"20px",height:"20px"},onChange:nl=>x(s)},null,40,tl)]),a("td",null,k(s.noST.noST),1),a("td",null,k(e.formatRupiah(b(s))),1)]))),128))])])])])])]),a("button",{onClick:N,class:"btn btn-primary mt-4",disabled:!p.value}," Simpan ",8,sl)])}}};export{rl as default};
