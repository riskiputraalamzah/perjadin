import{f as N,h as p,x as F,g as H,o as b,c as D,a as t,F as A,j as O,t as r,b as $,w as q,m as g,v as c,d as J,S as _}from"./index-D96A8p5g.js";import{_ as G}from"./ModalItem-DjE8K5VS.js";import{T as o}from"./ToastAlert-C14YVEyY.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y=["disabled"],z={class:"table-responsive"},Q={class:"table table-striped table-bordered"},R={key:0},W=["textContent"],X=["textContent"],Z=["textContent"],aa=["textContent"],ta=["textContent"],ea=["textContent"],na={class:"text-center"},la=["onClick"],oa=["onClick"],sa={key:1},ra={colspan:"7",class:"text-center"},ia={class:"mb-3"},ua={class:"mb-3"},da={class:"mb-3"},ga={class:"mb-3"},ca={class:"mb-3"},ma=["min","disabled"],fa={class:"mb-3"},m="sppd",Pa={__name:"MainSPPDView",setup(va){const f=N(),e=p({noSPPD:"",tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}),T=()=>{e.value={noSPPD:"",tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}},w=()=>{T(),i.value={title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:e.value}},C=l=>{e.value={...l},i.value={title:"Edit Data SPPD",confirmButtonText:"Update",actionType:"edit",data:e.value}},i=p({title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:{}}),P=p([]),u=p(!0),h=F(),k=async()=>{P.value=await f.fetchData(m),h.dataSPPD=P.value};H(async()=>{if(h.dataSPPD){u.value=!u.value,P.value=h.dataSPPD;return}await k(),u.value=!u.value});const j=()=>e.value.noSPPD?e.value.tgl?e.value.tujuan.trim()?e.value.tglBerangkat?e.value.tglPulang?new Date(e.value.tglPulang)<=new Date(e.value.tglBerangkat)?(o.fire({icon:"error",title:"Tanggal pulang harus lebih besar dari tanggal keberangkatan"}),!1):e.value.lamaPenugasan?!0:(o.fire({icon:"error",title:"Lama penugasan harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal pulang harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal keberangkatan harus diisi"}),!1):(o.fire({icon:"error",title:"Tujuan harus diisi"}),!1):(o.fire({icon:"error",title:"Tanggal SPPD harus diisi"}),!1):(o.fire({icon:"error",title:"Nomor SPPD harus diisi"}),!1),B=async({actionType:l})=>{if(j())try{const a=JSON.parse(JSON.stringify(e.value));l==="add"?(await f.addItem(m,a),o.fire({icon:"success",title:"Data SPPD berhasil ditambahkan"})):l==="edit"&&(await f.updateData(m,"id",a.id,a),o.fire({icon:"success",title:"Data SPPD berhasil diubah"})),await k(m),T();const n=document.getElementById("staticBackdrop"),s=window.bootstrap.Modal.getInstance(n);s&&s.hide();const v=document.querySelector(".modal-backdrop");v&&v.remove()}catch(a){console.error("Error:",a),o.fire({icon:"error",title:"Terjadi kesalahan"})}},I=async l=>{if((await _.fire({title:"Hapus Data SPPD?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{const n=await M(l);if(n!=null&&n.status){_.fire({icon:"error",title:"Data gagal dihapus",text:n.message});return}await f.deleteItemById(m,l)?(o.fire({icon:"success",title:"Data SPPD berhasil dihapus"}),await k(m)):o.fire({icon:"error",title:"Gagal menghapus data"})}catch(n){console.error("Error deleting item:",n),o.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},M=async l=>{try{const a=["delegasiPegawai"];for(const n of a){const s=await f.fetchData(n);if(console.log({dataarray:s,id:l}),s.some(L=>{var y;return(y=L.relation)==null?void 0:y.some(U=>{var x;return((x=U.noSPPD)==null?void 0:x.id)===l})}))return{status:!0,message:"Data sedang digunakan pada menu Delegasi Pegawai"}}return!1}catch(a){return console.error("Error checking if data is in use:",a),!1}},V=()=>{e.value.tglBerangkat?(d.value=new Date(e.value.tglBerangkat),d.value.setDate(d.value.getDate()+1),d.value=d.value.toISOString().split("T")[0],e.value.tglPulang&&new Date(e.value.tglPulang)<=new Date(e.value.tglBerangkat)&&(e.value.tglPulang="",e.value.lamaPenugasan="")):(e.value.tglPulang="",e.value.lamaPenugasan="")},E=()=>{if(e.value.tglBerangkat&&e.value.tglPulang){const l=new Date(e.value.tglBerangkat),a=new Date(e.value.tglPulang),n=Math.abs(a-l),s=Math.ceil(n/(1e3*60*60*24));e.value.lamaPenugasan=s}else e.value.lamaPenugasan=""},S=l=>{if(!l)return"";const a={day:"numeric",month:"long",year:"numeric"};return new Date(l).toLocaleDateString("id-ID",a)},d=p("");return(l,a)=>(b(),D("div",null,[a[13]||(a[13]=t("h1",{class:"text-dark fw-bold mb-4"},"List Surat Perintah Perjalanan Dinas",-1)),t("button",{class:"btn btn-primary mb-4",onClick:w,disabled:u.value,"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop"}," Tambah Data ",8,Y),t("div",z,[t("table",Q,[a[6]||(a[6]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No SPPD"),t("th",{scope:"col"},"Tanggal SPPD"),t("th",{scope:"col"},"Tujuan"),t("th",{scope:"col"},"Tgl Berangkat"),t("th",{scope:"col"},"Tgl Pulang"),t("th",{scope:"col"},"Lama Penugasan"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),P.value.length>0?(b(),D("tbody",R,[(b(!0),D(A,null,O(P.value,(n,s)=>(b(),D("tr",{key:s},[t("td",{textContent:r(n.noSPPD)},null,8,W),t("td",{textContent:r(S(n.tgl))},null,8,X),t("td",{textContent:r(n.tujuan)},null,8,Z),t("td",{textContent:r(S(n.tglBerangkat))},null,8,aa),t("td",{textContent:r(S(n.tglPulang))},null,8,ta),t("td",{textContent:r(n.lamaPenugasan+" Hari")},null,8,ea),t("td",na,[t("button",{class:"btn-danger btn btn-sm",onClick:v=>I(n.id)},"Hapus",8,la),t("button",{"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",class:"btn-sm btn-warning btn",onClick:v=>C(n)}," Edit ",8,oa)])]))),128))])):(b(),D("tbody",sa,[t("tr",null,[t("td",ra,r(u.value?"Loading Data...":"Data masih kosong"),1)])]))])]),$(G,{title:i.value.title,confirmButtonText:i.value.confirmButtonText,actionType:i.value.actionType,data:i.value.data,onConfirm:B},{body:q(()=>[t("form",{onSubmit:J(B,["prevent"])},[t("div",ia,[a[7]||(a[7]=t("label",{for:"noSPPD",class:"form-label"},"Nomor SPPD",-1)),g(t("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>e.value.noSPPD=n),type:"text",class:"form-control",id:"noSPPD"},null,512),[[c,e.value.noSPPD]])]),t("div",ua,[a[8]||(a[8]=t("label",{for:"tgl",class:"form-label"},"Tanggal SPPD",-1)),g(t("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.tgl=n),type:"date",class:"form-control",id:"tgl"},null,512),[[c,e.value.tgl]])]),t("div",da,[a[9]||(a[9]=t("label",{for:"uraian",class:"form-label"},"Tujuan",-1)),g(t("input",{id:"uraian","onUpdate:modelValue":a[2]||(a[2]=n=>e.value.tujuan=n),class:"form-control",type:"text"},null,512),[[c,e.value.tujuan]])]),t("div",ga,[a[10]||(a[10]=t("label",{for:"tglBerangkat",class:"form-label"},"Tanggal Keberangkatan",-1)),g(t("input",{"onUpdate:modelValue":a[3]||(a[3]=n=>e.value.tglBerangkat=n),type:"date",class:"form-control",id:"tglBerangkat",onChange:V},null,544),[[c,e.value.tglBerangkat]])]),t("div",ca,[a[11]||(a[11]=t("label",{for:"tglPulang",class:"form-label"},"Tanggal Pulang",-1)),g(t("input",{"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.tglPulang=n),type:"date",min:d.value,class:"form-control",id:"tglPulang",disabled:!e.value.tglBerangkat,onChange:E},null,40,ma),[[c,e.value.tglPulang]])]),t("div",fa,[a[12]||(a[12]=t("label",{for:"lamaPenugasan",class:"form-label"},"Lama Penugasan (Hari)",-1)),g(t("input",{"onUpdate:modelValue":a[5]||(a[5]=n=>e.value.lamaPenugasan=n),type:"text",class:"form-control",id:"lamaPenugasan",readonly:""},null,512),[[c,e.value.lamaPenugasan]])])],32)]),_:1},8,["title","confirmButtonText","actionType","data"])]))}},ka=K(Pa,[["__scopeId","data-v-6525be77"]]);export{ka as default};
