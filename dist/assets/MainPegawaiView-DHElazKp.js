import{f as N,x as E,h as p,g as M,o as g,c as b,a as t,F as U,j as V,t as c,b as G,w as J,m as v,v as h,d as $,S as k}from"./index-D96A8p5g.js";import{_ as F}from"./ModalItem-DjE8K5VS.js";import{T as s}from"./ToastAlert-C14YVEyY.js";const L=["disabled"],A={class:"table-responsive"},q={class:"table table-striped table-bordered"},H={key:0},O=["textContent"],Y=["textContent"],z=["textContent"],K=["textContent"],Q=["textContent"],R={class:"text-center"},W=["onClick"],X=["onClick"],Z={key:1},tt={colspan:"6",class:"text-center"},at={class:"mb-3"},et={class:"mb-3"},ot={class:"mb-3"},nt={class:"mb-3"},l="pegawai",dt={__name:"MainPegawaiView",setup(st){const u=N(),w=E(),o=p({namaPegawai:"",nip:"",golongan:"",jabatan:""}),m=p([]),r=p(!0),x=async()=>{m.value=await u.fetchData(l),w.dataPegawai=m.value};M(async()=>{if(w.dataPegawai){r.value=!r.value,m.value=w.dataPegawai;return}await x(),r.value=!r.value});const C=()=>o.value.namaPegawai?o.value.nip?o.value.golongan?o.value.jabatan?!0:(s.fire({icon:"error",title:"Jabatan harus diisi"}),!1):(s.fire({icon:"error",title:"Golongan harus diisi"}),!1):(s.fire({icon:"error",title:"NIP harus diisi"}),!1):(s.fire({icon:"error",title:"Nama Pegawai harus diisi"}),!1),y=async({actionType:n})=>{if(C())try{const a=JSON.parse(JSON.stringify(o.value));n==="add"?(await u.addItem(l,a),s.fire({icon:"success",title:"Data Pegawai berhasil ditambahkan"})):n==="edit"&&(await u.updateData(l,"id",a.id,a),s.fire({icon:"success",title:"Data Pegawai berhasil diubah"})),await x(l),P();const e=document.getElementById("staticBackdrop"),i=window.bootstrap.Modal.getInstance(e);i&&i.hide();const f=document.querySelector(".modal-backdrop");f&&f.remove()}catch(a){console.error("Error:",a),s.fire({icon:"error",title:"Terjadi kesalahan"})}},P=()=>{o.value={namaPegawai:"",nip:"",golongan:"",jabatan:""}},D=async n=>{if((await k.fire({title:`Hapus Data ${l}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{const e=await I(n);if(e!=null&&e.status){k.fire({icon:"error",title:"Data gagal dihapus",text:e.message});return}await u.deleteItemById(l,n)?(s.fire({icon:"success",title:`Data ${l} berhasil dihapus`}),await x(l)):s.fire({icon:"error",title:"Gagal menghapus data"})}catch(e){console.error("Error deleting item:",e),s.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},T=()=>{P(),d.value={title:"Tambah Data Pegawai",confirmButtonText:"Simpan",actionType:"add",data:o.value}},B=n=>{o.value={...n},d.value={title:"Edit Data Pegawai",confirmButtonText:"Update",actionType:"edit",data:o.value}},d=p({title:"Tambah Data Pegawai",confirmButtonText:"Simpan",actionType:"add",data:{}}),I=async n=>{try{const a=["delegasiPegawai"];for(const e of a){const i=await u.fetchData(e);if(console.log({dataarray:i,id:n}),i.some(S=>{var _;return(_=S.relation)==null?void 0:_.some(j=>j.pegawai.id===n)}))return{status:!0,message:"Data sedang digunakan pada menu Delegasi Pegawai"}}return{status:!1}}catch(a){return console.error("Error checking if data is in use:",a),{status:!1}}};return(n,a)=>(g(),b("div",null,[a[9]||(a[9]=t("h1",{class:"text-dark fw-bold mb-4"},"List Pegawai",-1)),t("button",{type:"button",class:"btn btn-primary mb-4",onClick:T,disabled:r.value,"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop"}," Tambah Data ",8,L),t("div",A,[t("table",q,[a[4]||(a[4]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No"),t("th",{scope:"col"},"Nama"),t("th",{scope:"col"},"NIP"),t("th",{scope:"col"},"Golongan"),t("th",{scope:"col"},"Jabatan"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),m.value.length>0?(g(),b("tbody",H,[(g(!0),b(U,null,V(m.value,(e,i)=>(g(),b("tr",{key:i},[t("td",{textContent:c(i+1)},null,8,O),t("td",{textContent:c(e.namaPegawai)},null,8,Y),t("td",{textContent:c(e.nip)},null,8,z),t("td",{textContent:c(e.golongan)},null,8,K),t("td",{textContent:c(e.jabatan)},null,8,Q),t("td",R,[t("button",{class:"btn-danger btn btn-sm",onClick:f=>D(e.id)},"Hapus",8,W),t("button",{"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",class:"btn-sm btn-warning btn",onClick:f=>B(e)}," Edit ",8,X)])]))),128))])):(g(),b("tbody",Z,[t("tr",null,[t("td",tt,c(r.value?"Loading Data...":"Data masih kosong"),1)])]))])]),G(F,{title:d.value.title,confirmButtonText:d.value.confirmButtonText,actionType:d.value.actionType,data:d.value.data,onConfirm:y},{body:J(()=>[t("form",{onSubmit:$(y,["prevent"])},[t("div",at,[a[5]||(a[5]=t("label",{for:"namaPegawai",class:"form-label"},"Nama Pegawai",-1)),v(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.value.namaPegawai=e),type:"text",class:"form-control",id:"namaPegawai"},null,512),[[h,o.value.namaPegawai]])]),t("div",et,[a[6]||(a[6]=t("label",{for:"NIP",class:"form-label"},"NIP",-1)),v(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.nip=e),type:"text",class:"form-control",id:"NIP"},null,512),[[h,o.value.nip]])]),t("div",ot,[a[7]||(a[7]=t("label",{for:"Golongan",class:"form-label"},"Golongan",-1)),v(t("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.golongan=e),type:"text",class:"form-control",id:"Golongan"},null,512),[[h,o.value.golongan]])]),t("div",nt,[a[8]||(a[8]=t("label",{for:"jabatan",class:"form-label"},"Jabatan",-1)),v(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>o.value.jabatan=e),type:"text",class:"form-control",id:"jabatan"},null,512),[[h,o.value.jabatan]])])],32)]),_:1},8,["title","confirmButtonText","actionType","data"])]))}};export{dt as default};
