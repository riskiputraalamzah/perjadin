import{f as v,h as g,x as C,g as x,r as y,o as i,c as l,a as t,b as D,w,F as M,j as P,t as d,p as T,S as _}from"./index-D96A8p5g.js";import{T as m}from"./ToastAlert-C14YVEyY.js";const B={class:"table-responsive"},I={class:"table table-striped table-bordered"},N={key:0},E=["textContent"],V=["textContent"],$=["textContent"],j={class:"text-center"},L=["onClick"],A=["onClick"],F={key:1},H={colspan:"6",class:"text-center"},p="spm",R={__name:"MainSPMView",setup(U){const u=v(),r=g([]),n=g(!0),c=C(),f=async()=>{r.value=await u.fetchData(p),c.dataSPM=r.value};x(async()=>{if(console.log(c),c.dataSPM){n.value=!n.value,r.value=c.dataSPM;return}await f(),n.value=!n.value});const S=async s=>{if((await _.fire({title:"Hapus Data?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{const a=await k(s);if(a!=null&&a.status){_.fire({icon:"error",title:"Data gagal dihapus",text:a.message});return}await u.deleteItemById(p,s)?(m.fire({icon:"success",title:"Data berhasil dihapus"}),await f(p)):m.fire({icon:"error",title:"Gagal menghapus data"})}catch(a){console.error("Error deleting item:",a),m.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},k=async s=>{try{const e=["sp2d"];for(const a of e)if((await u.fetchData(a)).some(h=>h.spm.id===s))return{status:!0,message:"Data sedang digunakan pada menu SP2D"};return!1}catch(e){return console.error("Error checking if data is in use:",e),!1}};return(s,e)=>{const a=y("router-link");return i(),l("div",null,[e[2]||(e[2]=t("h1",{class:"text-dark fw-bold mb-4"},"List Surat Perintah Membayar",-1)),D(a,{to:"/spm/create",class:"btn btn-primary mb-4",disabled:n.value},{default:w(()=>e[0]||(e[0]=[T(" Tambah Data ")])),_:1},8,["disabled"]),t("div",B,[t("table",I,[e[1]||(e[1]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No SPM"),t("th",{scope:"col"},"Tanggal SPM"),t("th",{scope:"col"},"Nilai ST"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),r.value.length>0?(i(),l("tbody",N,[(i(!0),l(M,null,P(r.value,(o,b)=>(i(),l("tr",{key:b},[t("td",{textContent:d(o.noSPM)},null,8,E),t("td",{textContent:d(s.formatDate(o.tglSPM))},null,8,V),t("td",{textContent:d(s.formatRupiah(o.nilaiSPM))},null,8,$),t("td",j,[t("button",{class:"btn-danger btn btn-sm",onClick:h=>S(o.id)},"Hapus",8,L),t("button",{class:"btn-sm btn-warning btn",onClick:h=>s.$router.push(`/spm/${o.id}/edit`)}," Edit ",8,A)])]))),128))])):(i(),l("tbody",F,[t("tr",null,[t("td",H,d(n.value?"Loading Data...":"Data masih kosong"),1)])]))])])])}}};export{R as default};
