import{f as x,h as p,g as k,c,a as t,F as D,x as B,t as v,b as w,w as C,o as u,l as S,v as g,d as N,S as I}from"./index-IM4zRged.js";import{_ as E}from"./ModalItem-8FsWucZU.js";import{T as l}from"./ToastAlert-BNG8R7JE.js";const V=["disabled"],j={class:"table-responsive"},F={class:"table table-striped table-bordered"},U={key:0},L=["textContent"],$=["textContent"],q=["textContent"],A={class:"text-center"},H=["onClick"],J=["onClick"],O={key:1},G={colspan:"6",class:"text-center"},R={class:"mb-3"},Y={class:"mb-3"},z={class:"mb-3"},r="spm",Z={__name:"MainSPMView",setup(K){const i=x(),o=p({noSPM:"",tgl:"",nilaiSPM:""}),d=p([]),m=p(!0);k(async()=>{console.log("onmounted spm"),d.value=await i.fetchData(r),m.value=!m.value});const T=()=>o.value.noSPM?o.value.tgl?o.value.nilaiSPM?!0:(l.fire({icon:"error",title:"Nilai SPM harus diisi"}),!1):(l.fire({icon:"error",title:"Tanggal SPM harus diisi"}),!1):(l.fire({icon:"error",title:"Nomor SPM harus diisi"}),!1),h=async({actionType:n})=>{if(T())try{const e=JSON.parse(JSON.stringify(o.value));n==="add"?(await i.addItem(r,e),l.fire({icon:"success",title:"Data Surat Tugas berhasil ditambahkan"})):n==="edit"&&(await i.updateData(r,"id",e.id,e),l.fire({icon:"success",title:"Data Surat Tugas berhasil diubah"})),d.value=await i.fetchData(r),M();const a=document.getElementById("staticBackdrop"),f=window.bootstrap.Modal.getInstance(a);f&&f.hide();const b=document.querySelector(".modal-backdrop");b&&b.remove()}catch(e){console.error("Error:",e),l.fire({icon:"error",title:"Terjadi kesalahan"})}},M=()=>{o.value={noSPM:"",tgl:"",nilaiSPM:""}},y=async n=>{if((await I.fire({title:"Hapus Data?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{await i.deleteItemById(r,n)?(l.fire({icon:"success",title:"Data berhasil dihapus"}),d.value=await i.fetchData(r)):l.fire({icon:"error",title:"Gagal menghapus data"})}catch(a){console.error("Error deleting item:",a),l.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},P=()=>{M(),s.value={title:"Tambah Data",confirmButtonText:"Simpan",actionType:"add",data:o.value}},_=n=>{o.value={...n},s.value={title:"Edit Data",confirmButtonText:"Update",actionType:"edit",data:o.value}},s=p({title:"Tambah Data",confirmButtonText:"Simpan",actionType:"add",data:{}});return(n,e)=>(u(),c("div",null,[e[7]||(e[7]=t("h1",{class:"text-dark fw-bold mb-4"},"List Surat Perintah Membayar",-1)),t("button",{type:"button",class:"btn btn-primary mb-4",onClick:P,disabled:m.value,"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop"}," Tambah Data ",8,V),t("div",j,[t("table",F,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No SPM"),t("th",{scope:"col"},"Tanggal SPM"),t("th",{scope:"col"},"Nilai ST"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),d.value.length>0?(u(),c("tbody",U,[(u(!0),c(D,null,B(d.value,(a,f)=>(u(),c("tr",{key:f},[t("td",{textContent:v(a.noSPM)},null,8,L),t("td",{textContent:v(n.formatDate(a.tgl))},null,8,$),t("td",{textContent:v(n.formatRupiah(a.nilaiSPM))},null,8,q),t("td",A,[t("button",{class:"btn-danger btn btn-sm",onClick:b=>y(a.id)},"Hapus",8,H),t("button",{"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",class:"btn-sm btn-warning btn",onClick:b=>_(a)}," Edit ",8,J)])]))),128))])):(u(),c("tbody",O,[t("tr",null,[t("td",G,v(m.value?"Loading Data...":"Data masih kosong"),1)])]))])]),w(E,{title:s.value.title,confirmButtonText:s.value.confirmButtonText,actionType:s.value.actionType,data:s.value.data,onConfirm:h},{body:C(()=>[t("form",{onSubmit:N(h,["prevent"])},[t("div",R,[e[4]||(e[4]=t("label",{for:"noST",class:"form-label"},"Nomor SPM",-1)),S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.noSPM=a),type:"text",class:"form-control",id:"noST"},null,512),[[g,o.value.noSPM]])]),t("div",Y,[e[5]||(e[5]=t("label",{for:"tgl",class:"form-label"},"Tanggal SPM",-1)),S(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.tgl=a),type:"date",class:"form-control",id:"tgl"},null,512),[[g,o.value.tgl]])]),t("div",z,[e[6]||(e[6]=t("label",{for:"nilaiSPM",class:"form-label"},"Nilai SPM",-1)),S(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.noSPM=a),type:"text",class:"form-control",id:"nilaiSPM"},null,512),[[g,o.value.noSPM]])])],32)]),_:1},8,["title","confirmButtonText","actionType","data"])]))}};export{Z as default};
