import{x as B,f as R,q as E,u as U,h as r,g as $,y as h,r as I,o as u,c as d,a,b as O,w as z,t as M,m as T,v as _,n as P,s as S,F as J,j as q,z as k,p as K}from"./index-BdjIFSqz.js";import{T as L}from"./ToastAlert-B6CVaos9.js";const A={"aria-label":"breadcrumb"},G={class:"breadcrumb"},H={class:"breadcrumb-item"},Q={class:"text-dark fw-bold mb-4"},W={class:"row"},X={class:"col-md-6 col-lg-4"},Y={key:0,class:"invalid-feedback"},Z={class:"col-md-6 col-lg-4"},ee={key:0,class:"invalid-feedback"},ae={class:"col-md-6 col-lg-4"},le=["value"],te={key:0,class:"invalid-feedback"},se={class:"col-12"},ne={class:"card"},oe={class:"card-body"},ie={class:"table-sm table table-bordered"},ue={key:0,class:"text-center"},de=["onChange","checked"],re=["disabled"],Me={__name:"EditSPM",setup(Se){const y=B(),c=R(),w=E(),N=U(),p=parseInt(N.params.id),v=r([]),t=r({noSPM:"",tglSPM:"",nilaiSPM:0}),b=r({noSPM:"",tglSPM:"",nilaiSPM:0}),n=r({noSPM:!1,tglSPM:!1,nilaiSPM:!1}),o=r([]);$(async()=>{const l=await c.findData("spm",p);l&&(t.value=l,b.value={...l},o.value=l.selectedST||[]),v.value=await c.fetchData("delegasiPegawai")});const x=async()=>{if(!g.value)return;m.value=!0;const l={...k(t.value),selectedST:k(o.value)};await c.updateData("spm","id",p,l),m.value=!1,L.fire({icon:"success",title:"Data Berhasil diupdate"}),y.dataSPM=null,w.push("/spm")},D=l=>o.value.some(e=>e.noST.noST===l.noST.noST),f=l=>{var e;return(e=l.relation)==null?void 0:e.reduce((i,s)=>i+s.totalSemuaDana,0)},F=()=>{const l=o.value.reduce((e,i)=>e+f(i),0);t.value.nilaiSPM=l},C=l=>{const e=o.value.findIndex(i=>i.noST.noST===l.noST.noST);e===-1?o.value.push(l):o.value.splice(e,1),F()},V=h(()=>JSON.stringify(t.value)!==JSON.stringify(b.value)),m=r(!1),g=h({get(){return V.value&&t.value.noSPM!==""&&t.value.tglSPM!==""&&t.value.nilaiSPM>0},set(l){m.value=l}});return(l,e)=>{const i=I("router-link");return u(),d("div",null,[a("nav",A,[a("ol",G,[a("li",H,[O(i,{to:{name:"spm"}},{default:z(()=>e[5]||(e[5]=[K("SPM")])),_:1})]),e[6]||(e[6]=a("li",{class:"breadcrumb-item","aria-current":"page"},"Edit Data",-1))])]),a("h1",Q,"Edit Data SPM "+M(),1),a("div",W,[a("div",X,[a("div",null,[e[7]||(e[7]=a("label",{for:"noSPM",class:"form-label"},"No SPM",-1)),T(a("input",{type:"text",class:P(["form-control",{"is-invalid":n.value.noSPM&&t.value.noSPM===""}]),"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.noSPM=s),id:"noSPM",onFocus:e[1]||(e[1]=s=>n.value.noSPM=!0)},null,34),[[_,t.value.noSPM]]),n.value.noSPM&&t.value.noSPM===""?(u(),d("div",Y," No SPM wajib diisi. ")):S("",!0)])]),a("div",Z,[a("div",null,[e[8]||(e[8]=a("label",{for:"tglSPM",class:"form-label"},"Tanggal SPM",-1)),T(a("input",{type:"date",class:P(["form-control",{"is-invalid":n.value.tglSPM&&t.value.tglSPM===""}]),"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.tglSPM=s),id:"tglSPM",onFocus:e[3]||(e[3]=s=>n.value.tglSPM=!0)},null,34),[[_,t.value.tglSPM]]),n.value.tglSPM&&t.value.tglSPM===""?(u(),d("div",ee," Tanggal SPM wajib diisi. ")):S("",!0)])]),a("div",ae,[a("div",null,[e[9]||(e[9]=a("label",{for:"nilai",class:"form-label"},"Nilai SPM",-1)),a("input",{type:"text",class:P(["form-control",{"is-invalid":n.value.nilaiSPM&&t.value.nilaiSPM<=0}]),value:l.formatRupiah(t.value.nilaiSPM),readonly:"",id:"nilai",onFocus:e[4]||(e[4]=s=>n.value.nilaiSPM=!0)},null,42,le),n.value.nilaiSPM&&t.value.nilaiSPM<=0?(u(),d("div",te," Nilai SPM wajib diisi. ")):S("",!0),e[10]||(e[10]=a("span",{class:"fs-1 text-info"}," Untuk mengisi Nilai SPM, Silahkan pilih ST dari tabel di bawah ",-1))])]),a("div",se,[a("div",ne,[e[12]||(e[12]=a("div",{class:"card-header"},"Pilih NO ST",-1)),a("div",oe,[a("table",ie,[e[11]||(e[11]=a("thead",null,[a("tr",null,[a("th",null,"Pilih"),a("th",null,"No ST"),a("th",null,"Total Dana Seluruhnya")])],-1)),a("tbody",null,[v.value.length<0?(u(),d("div",ue,"Data Masih Kosong")):S("",!0),(u(!0),d(J,null,q(v.value,(s,j)=>(u(),d("tr",{key:j},[a("td",null,[a("input",{class:"form-check-input",type:"checkbox",style:{width:"20px",height:"20px"},onChange:ce=>C(s),checked:D(s)},null,40,de)]),a("td",null,M(s.noST.noST),1),a("td",null,M(l.formatRupiah(f(s))),1)]))),128))])])])])])]),a("button",{onClick:x,class:"btn btn-warning mt-4",disabled:!g.value}," Update ",8,re)])}}};export{Me as default};
