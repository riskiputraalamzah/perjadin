import{f as I,h as f,x as M,g as V,c as v,a as t,F as L,y as E,t as s,b as N,w as U,o as p,l as g,v as c,d as F,S as H}from"./index-xVDuUUEs.js";import{_ as A}from"./ModalItem-DLsxKHtc.js";import{T as l}from"./ToastAlert-uFlgKPi0.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $=["disabled"],q={class:"table-responsive"},J={class:"table table-striped table-bordered"},G={key:0},K=["textContent"],Y=["textContent"],z=["textContent"],Q=["textContent"],R=["textContent"],W=["textContent"],X={class:"text-center"},Z=["onClick"],tt=["onClick"],at={key:1},et={colspan:"7",class:"text-center"},nt={class:"mb-3"},lt={class:"mb-3"},ot={class:"mb-3"},st={class:"mb-3"},it={class:"mb-3"},rt=["min","disabled"],ut={class:"mb-3"},m="sppd",dt={__name:"MainSPPDView",setup(gt){const b=I(),a=f({noSPPD:"",tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}),T=()=>{a.value={noSPPD:"",tgl:"",tujuan:"",tglBerangkat:"",tglPulang:"",lamaPenugasan:""}},y=()=>{T(),i.value={title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:a.value}},x=o=>{a.value={...o},i.value={title:"Edit Data SPPD",confirmButtonText:"Update",actionType:"edit",data:a.value}},i=f({title:"Tambah Data SPPD",confirmButtonText:"Simpan",actionType:"add",data:{}}),P=f([]),r=f(!0),h=M(),S=async()=>{P.value=await b.fetchData(m),h.dataSPPD=P.value};V(async()=>{if(h.dataSPPD){r.value=!r.value,P.value=h.dataSPPD;return}await S(),r.value=!r.value});const _=()=>a.value.noSPPD?a.value.tgl?a.value.tujuan.trim()?a.value.tglBerangkat?a.value.tglPulang?new Date(a.value.tglPulang)<=new Date(a.value.tglBerangkat)?(l.fire({icon:"error",title:"Tanggal pulang harus lebih besar dari tanggal keberangkatan"}),!1):a.value.lamaPenugasan?!0:(l.fire({icon:"error",title:"Lama penugasan harus diisi"}),!1):(l.fire({icon:"error",title:"Tanggal pulang harus diisi"}),!1):(l.fire({icon:"error",title:"Tanggal keberangkatan harus diisi"}),!1):(l.fire({icon:"error",title:"Tujuan harus diisi"}),!1):(l.fire({icon:"error",title:"Tanggal SPPD harus diisi"}),!1):(l.fire({icon:"error",title:"Nomor SPPD harus diisi"}),!1),B=async({actionType:o})=>{if(_())try{const e=JSON.parse(JSON.stringify(a.value));o==="add"?(await b.addItem(m,e),l.fire({icon:"success",title:"Data SPPD berhasil ditambahkan"})):o==="edit"&&(await b.updateData(m,"id",e.id,e),l.fire({icon:"success",title:"Data SPPD berhasil diubah"})),await S(m),T();const n=document.getElementById("staticBackdrop"),d=window.bootstrap.Modal.getInstance(n);d&&d.hide();const D=document.querySelector(".modal-backdrop");D&&D.remove()}catch(e){console.error("Error:",e),l.fire({icon:"error",title:"Terjadi kesalahan"})}},w=async o=>{if((await H.fire({title:"Hapus Data SPPD?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak",cancelButtonColor:"red"})).isConfirmed)try{await b.deleteItemById(m,o)?(l.fire({icon:"success",title:"Data SPPD berhasil dihapus"}),await S(m)):l.fire({icon:"error",title:"Gagal menghapus data"})}catch(n){console.error("Error deleting item:",n),l.fire({icon:"error",title:"Terjadi kesalahan saat menghapus data"})}},C=()=>{a.value.tglBerangkat?(u.value=new Date(a.value.tglBerangkat),u.value.setDate(u.value.getDate()+1),u.value=u.value.toISOString().split("T")[0],a.value.tglPulang&&new Date(a.value.tglPulang)<=new Date(a.value.tglBerangkat)&&(a.value.tglPulang="",a.value.lamaPenugasan="")):(a.value.tglPulang="",a.value.lamaPenugasan="")},j=()=>{if(a.value.tglBerangkat&&a.value.tglPulang){const o=new Date(a.value.tglBerangkat),e=new Date(a.value.tglPulang),n=Math.abs(e-o),d=Math.ceil(n/(1e3*60*60*24));a.value.lamaPenugasan=d}else a.value.lamaPenugasan=""},k=o=>{if(!o)return"";const e={day:"numeric",month:"long",year:"numeric"};return new Date(o).toLocaleDateString("id-ID",e)},u=f("");return(o,e)=>(p(),v("div",null,[e[13]||(e[13]=t("h1",{class:"text-dark fw-bold mb-4"},"List Surat Perintah Perjalanan Dinas",-1)),t("button",{class:"btn btn-primary mb-4",onClick:y,disabled:r.value,"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop"}," Tambah Data ",8,$),t("div",q,[t("table",J,[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"No SPPD"),t("th",{scope:"col"},"Tanggal SPPD"),t("th",{scope:"col"},"Tujuan"),t("th",{scope:"col"},"Tgl Berangkat"),t("th",{scope:"col"},"Tgl Pulang"),t("th",{scope:"col"},"Lama Penugasan"),t("th",{scope:"col",class:"text-center"},"Action")])],-1)),P.value.length>0?(p(),v("tbody",G,[(p(!0),v(L,null,E(P.value,(n,d)=>(p(),v("tr",{key:d},[t("td",{textContent:s(n.noSPPD)},null,8,K),t("td",{textContent:s(k(n.tgl))},null,8,Y),t("td",{textContent:s(n.tujuan)},null,8,z),t("td",{textContent:s(k(n.tglBerangkat))},null,8,Q),t("td",{textContent:s(k(n.tglPulang))},null,8,R),t("td",{textContent:s(n.lamaPenugasan+" Hari")},null,8,W),t("td",X,[t("button",{class:"btn-danger btn btn-sm",onClick:D=>w(n.id)},"Hapus",8,Z),t("button",{"data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",class:"btn-sm btn-warning btn",onClick:D=>x(n)}," Edit ",8,tt)])]))),128))])):(p(),v("tbody",at,[t("tr",null,[t("td",et,s(r.value?"Loading Data...":"Data masih kosong"),1)])]))])]),N(A,{title:i.value.title,confirmButtonText:i.value.confirmButtonText,actionType:i.value.actionType,data:i.value.data,onConfirm:B},{body:U(()=>[t("form",{onSubmit:F(B,["prevent"])},[t("div",nt,[e[7]||(e[7]=t("label",{for:"noSPPD",class:"form-label"},"Nomor SPPD",-1)),g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.noSPPD=n),type:"text",class:"form-control",id:"noSPPD"},null,512),[[c,a.value.noSPPD]])]),t("div",lt,[e[8]||(e[8]=t("label",{for:"tgl",class:"form-label"},"Tanggal SPPD",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.tgl=n),type:"date",class:"form-control",id:"tgl"},null,512),[[c,a.value.tgl]])]),t("div",ot,[e[9]||(e[9]=t("label",{for:"uraian",class:"form-label"},"Tujuan",-1)),g(t("input",{id:"uraian","onUpdate:modelValue":e[2]||(e[2]=n=>a.value.tujuan=n),class:"form-control",type:"text"},null,512),[[c,a.value.tujuan]])]),t("div",st,[e[10]||(e[10]=t("label",{for:"tglBerangkat",class:"form-label"},"Tanggal Keberangkatan",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.tglBerangkat=n),type:"date",class:"form-control",id:"tglBerangkat",onChange:C},null,544),[[c,a.value.tglBerangkat]])]),t("div",it,[e[11]||(e[11]=t("label",{for:"tglPulang",class:"form-label"},"Tanggal Pulang",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.tglPulang=n),type:"date",min:u.value,class:"form-control",id:"tglPulang",disabled:!a.value.tglBerangkat,onChange:j},null,40,rt),[[c,a.value.tglPulang]])]),t("div",ut,[e[12]||(e[12]=t("label",{for:"lamaPenugasan",class:"form-label"},"Lama Penugasan (Hari)",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>a.value.lamaPenugasan=n),type:"text",class:"form-control",id:"lamaPenugasan",readonly:""},null,512),[[c,a.value.lamaPenugasan]])])],32)]),_:1},8,["title","confirmButtonText","actionType","data"])]))}},vt=O(dt,[["__scopeId","data-v-598ba978"]]);export{vt as default};
